---
title: "Task_4_analysis"
author: "Gleb V"
date: "22/07/2020"
output: 
  html_document:
    toc: true
    toc_float: true
---
# Task 4.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
library(tidyverse)
library(here)
all_candy_data <- read_csv(here::here("/clean_data/candy_data_combined.csv"))
```

## Answer 1.

* To calculate how many total rating were submitted I took total number of columns, subtracted 5, as the first 5 columns of the dataset do not contain ratings. I multiplied the result of subtraction by number of rows in the dataset. 
```{r}
num_col <- ncol(all_candy_data)-5
num_row <- nrow(all_candy_data)+0 # result is stored as an Integer without performing an arithmetic operation
total_ratings = num_col * num_row
```
There were total of `r as.integer(total_ratings)` submitted over 3 years.

## Answer 2. 
* Average age of people going out/not going out trick or treating was:
```{r}
average_age <- all_candy_data %>%
  select(age, trick_or_treating) %>%
  drop_na() %>%
  group_by(trick_or_treating) %>%
  summarise(unique(trick_or_treating), average_age = ceiling(mean(age))) %>%
  mutate(going_out = trick_or_treating, average_age) %>%
  select(going_out, average_age)
average_age
```

## Answer 3. 

* The following candies received the most "joy", "meh" and "despair" ratings.
```{r}
#count total of each rating for each candy
ratings_count <- all_candy_data %>% 
  pivot_longer(cols = "butterfinger":"sandwich_sized_bags_filled_with_booberry_crunch",
               names_to = "candy_name", 
               values_to = "candy_rating") %>%
  mutate(candy_rating = ifelse(is.na(candy_rating), "UNRATED", candy_rating)) %>% # replace NA ratings with chr "UNRATED"
  group_by(candy_name, candy_rating) %>%
  summarise(number_of_ratings_received = n())

#find candy rated top for "JOY"
top_joy <- ratings_count %>%
  filter(candy_rating == "JOY") %>% 
  arrange(desc(number_of_ratings_received)) %>%
  head(1)

#find candy rated top for "MEH"
top_meh <- ratings_count %>%
  filter(candy_rating == "MEH") %>% 
  arrange(desc(number_of_ratings_received)) %>%
  head(1)

#find candy rated top for "DESPAIR"
top_despair <- ratings_count %>%
  filter(candy_rating == "DESPAIR") %>% 
  arrange(desc(number_of_ratings_received)) %>%
  head(1)

#find top UNRATED candy
top_unrated <- ratings_count %>%
  filter(candy_rating == "UNRATED") %>% 
  arrange(desc(number_of_ratings_received)) %>%
  head(1)

#show all top candies in a single dataframe
top_ratings <- bind_rows(top_joy, top_meh, top_despair, top_unrated)

top_ratings
```
According to the survey, respondents were the most exited about getting a "proper size" candy, regardless of its brand or flavour. 

Personally, I agree with the general sentiment of the survey - lollipos are... well... "meh".

Having analysed this dataset, I went to read about trick or treating in general. Turns out it is a thing to get glow sticks for halloween, the problem arises when they break. Click [here](https://chicago.cbslocal.com/2013/10/30/glow-sticks-top-worry-for-parents-calling-poison-control-on-halloween/) to read more.


## Answer 4. 
```{r}

```


